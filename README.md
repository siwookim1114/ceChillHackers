# ceChillHackers

Hackathon MVP for a personalized AI teacher.

## What is implemented

- `Practice Session` flow
  - Guest start (`/`)
  - Onboarding (`/onboarding`)
  - Problem start from home (`/home`) -> creates `attempt`
  - Solve screen with work canvas + coach panel (`/solve/:attemptId`)
  - Result summary timeline (`/result/:attemptId`)
- `Event Logging`
  - Frontend queues events and sends batched payload every 5 seconds
  - Event types: `stroke_add`, `stroke_erase`, `idle_ping`, `hint_request`, `answer_submit`
- `Stuck Score + Explainability`
  - Backend computes rule-based stuck signals and score
  - Coach Panel shows why intervention happened
- `Auto Intervention`
  - Hint level 1 to 3 generated by simple backend templates
- `Result Summary`
  - Metrics: `time-to-solve`, `max stuck`, `hint max level`, `erase count`
  - Timeline: practice start, interventions, solved

## Project structure

- `backend/app/main.py`: FastAPI server, in-memory attempt/event store, stuck scoring, intervention, summary API
- `backend/prompts/system_prompt.txt`: AI tutor system prompt
- `backend/prompts/user_prompt_template.txt`: per-request user prompt template
- `frontend/`: React + Vite client with route-based pages

## PostgreSQL (Docker, minimal)

```bash
cp .env.example .env
docker compose up -d db
docker compose ps
```

Connection check:

```bash
psql "postgresql://<POSTGRES_USER>:<POSTGRES_PASSWORD>@localhost:5432/<POSTGRES_DB>" -c "select 1;"
```

## Shared RDS connection

Set `DATABASE_URL` in `.env`:

```bash
DATABASE_URL=postgresql://postgres:<DB_PASSWORD>@team-shared-pg.cebg4w0q26rg.us-east-1.rds.amazonaws.com:5432/postgres
```

Backend now uses PostgreSQL automatically when `DATABASE_URL` is present.
Without `DATABASE_URL`, it falls back to in-memory storage.

## Lecture file storage (S3)

Lecture uploads are stored in S3 under this prefix by default:

```bash
S3_LECTURE_UPLOAD_URI=s3://cechillhacker-filebucket/docs/lecture_slides/
```

Set AWS credentials in `.env` (or use an IAM role on the host):

```bash
AWS_REGION=ap-northeast-2
AWS_ACCESS_KEY_ID=...
AWS_SECRET_ACCESS_KEY=...
# optional for temporary credentials
AWS_SESSION_TOKEN=
```

The backend stores S3 metadata (`storage_key`, `file_url`) in `lecture_files`.

## Voice lecture orchestration (Featherless + Whisper + MiniMax)

The solve page supports a mediated voice tutor flow:

- Student speech -> Whisper-compatible STT
- Transcript + lecture context -> Featherless LLM mediator
- Tutor reply text -> MiniMax TTS audio

Set API keys in root `.env`:

```bash
FEATHERLESS_API_BASE_URL=https://api.featherless.ai/v1
FEATHERLESS_API_KEY=...
FEATHERLESS_MODEL=Qwen/Qwen2.5-3B-Instruct
FEATHERLESS_HTTP_REFERER=http://localhost:5173
FEATHERLESS_X_TITLE=TutorCoach
FEATHERLESS_USER_AGENT=TutorCoach/1.0
# If you get Cloudflare 1010, enable curl transport
FEATHERLESS_FORCE_CURL=true
# If Featherless is still blocked, allow temporary local mediator fallback
FEATHERLESS_LOCAL_FALLBACK=true

WHISPER_API_BASE_URL=https://api.openai.com/v1
WHISPER_API_KEY=...
WHISPER_MODEL=whisper-1
WHISPER_TRANSCRIBE_PATH=/audio/transcriptions

MINIMAX_API_BASE_URL=https://api.minimax.io
MINIMAX_API_KEY=...
# Optional on some tenants; set only if your account requires GroupId
MINIMAX_GROUP_ID=
MINIMAX_TTS_MODEL=speech-02-hd
MINIMAX_TTS_VOICE_ID=male-qn-qingse
MINIMAX_TTS_OUTPUT_FORMAT=hex
```

## Run locally

### Backend

```bash
cd backend
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
uvicorn app.main:app --reload --port 8000
```

### Frontend

```bash
cd frontend
npm install
npm run dev
```

Default API base URL is `http://localhost:8000`.  
You can override with `VITE_API_URL`.

## API summary

- `GET /api/problems`
- `POST /api/attempts`
- `GET /api/attempts/{attempt_id}`
- `POST /api/attempts/{attempt_id}/events`
- `GET /api/attempts/{attempt_id}/intervention`
- `GET /api/attempts/{attempt_id}/summary`

## Demo script reference

See `docs/demo_scenarios.md` for 3 demo-friendly problems, stuck acting points, and hint level samples.
